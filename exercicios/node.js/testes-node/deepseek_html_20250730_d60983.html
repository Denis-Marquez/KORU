<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testes de Assincronicidade</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
            min-height: 100px;
        }
        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <h1>Testes de Assincronicidade em JavaScript</h1>
    
    <div class="section">
        <h2>1. Callbacks</h2>
        <button onclick="testarCallbacks()">Testar Callbacks</button>
    </div>
    
    <div class="section">
        <h2>2. Promises</h2>
        <button onclick="testarPromises()">Testar Promises</button>
    </div>
    
    <div class="section">
        <h2>3. Múltiplas Promises</h2>
        <button onclick="testarMultiplasPromises()">Testar Promise.all/race</button>
    </div>
    
    <div class="section">
        <h2>4. Fetch API</h2>
        <button onclick="testarFetchGET()">Testar GET</button>
        <button onclick="testarFetchPOST()">Testar POST</button>
    </div>
    
    <div class="section">
        <h2>5. Tratar Respostas</h2>
        <button onclick="testarTratamentoRespostas()">Testar Tratamento</button>
    </div>
    
    <div class="section">
        <h2>6. Async/Await</h2>
        <button onclick="testarAsyncAwait()">Testar Async/Await</button>
    </div>
    
    <div id="output">Saída aparecerá aqui...</div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(mensagem) {
            output.innerHTML += `<p>${mensagem}</p>`;
            console.log(mensagem);
        }
        
        function limparOutput() {
            output.innerHTML = '';
        }
        
        // 1. Callbacks
        function fazerAlgoAssincrono(callback) {
            setTimeout(() => {
                log("Operação assíncrona concluída");
                callback(null, "Dados recebidos");
            }, 1000);
        }
        
        function testarCallbacks() {
            limparOutput();
            log("Iniciando teste de callbacks...");
            
            fazerAlgoAssincrono((erro, dados) => {
                if (erro) {
                    log(`Erro: ${erro}`);
                } else {
                    log(`Sucesso: ${dados}`);
                    // Callback hell
                    fazerAlgoAssincrono((erro2, dados2) => {
                        if (erro2) {
                            log(`Erro: ${erro2}`);
                        } else {
                            log(`Sucesso: ${dados2}`);
                        }
                    });
                }
            });
        }
        
        // 2. Promises
        function operacaoAssincrona() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    const sucesso = Math.random() > 0.3;
                    if (sucesso) {
                        resolve("Operação bem-sucedida!");
                    } else {
                        reject("Erro: Algo deu errado");
                    }
                }, 1500);
            });
        }
        
        function testarPromises() {
            limparOutput();
            log("Iniciando teste de promises...");
            
            operacaoAssincrona()
                .then(resultado => {
                    log(`Sucesso: ${resultado}`);
                    return "Novo valor para próxima then";
                })
                .then(novoValor => {
                    log(`Segundo then: ${novoValor}`);
                })
                .catch(erro => {
                    log(`Falha: ${erro}`);
                })
                .finally(() => {
                    log("Isso sempre executa, independente de sucesso ou falha");
                });
        }
        
        // 3. Múltiplas Promises
        function testarMultiplasPromises() {
            limparOutput();
            log("Iniciando teste de múltiplas promises...");
            
            const promise1 = Promise.resolve(3);
            const promise2 = 42;
            const promise3 = new Promise((resolve) => {
                setTimeout(resolve, 100, 'foo');
            });
            
            // Promise.all
            Promise.all([promise1, promise2, promise3])
                .then(values => {
                    log(`Promise.all: ${JSON.stringify(values)}`);
                });
            
            // Promise.race
            const promise4 = new Promise((resolve) => setTimeout(resolve, 500, 'mais rápido'));
            const promise5 = new Promise((resolve) => setTimeout(resolve, 100, 'mais lento'));
            
            Promise.race([promise4, promise5])
                .then(value => {
                    log(`Promise.race: ${value}`);
                });
        }
        
        // 4. Fetch API
        function testarFetchGET() {
            limparOutput();
            log("Iniciando teste de fetch GET...");
            
            fetch('https://jsonplaceholder.typicode.com/posts/1')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    log(`GET Response: ${JSON.stringify(data, null, 2)}`);
                })
                .catch(error => {
                    log(`GET Error: ${error}`);
                });
        }
        
        function testarFetchPOST() {
            limparOutput();
            log("Iniciando teste de fetch POST...");
            
            fetch('https://jsonplaceholder.typicode.com/posts', {
                method: 'POST',
                body: JSON.stringify({
                    title: 'foo',
                    body: 'bar',
                    userId: 1,
                }),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                },
            })
                .then(response => response.json())
                .then(data => {
                    log(`POST Response: ${JSON.stringify(data, null, 2)}`);
                });
        }
        
        // 5. Tratamento de Respostas
        function testarTratamentoRespostas() {
            limparOutput();
            log("Iniciando teste de tratamento de respostas...");
            
            fetch('https://jsonplaceholder.typicode.com/posts/1')
                .then(response => {
                    log(`Status: ${response.status}`);
                    log(`OK? ${response.ok}`);
                    return response.text();
                })
                .then(data => {
                    log(`Corpo da resposta: ${data}`);
                });
        }
        
        // 6. Async/Await
        async function buscarDados() {
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                log(`Dados com async/await: ${JSON.stringify(data, null, 2)}`);
                
                return data;
            } catch (error) {
                log(`Erro no async/await: ${error}`);
            } finally {
                log("Finalização do async/await");
            }
        }
        
        function testarAsyncAwait() {
            limparOutput();
            log("Iniciando teste de async/await...");
            
            buscarDados().then(data => {
                log(`Dados retornados: ${JSON.stringify(data, null, 2)}`);
            });
        }
    </script>
</body>
</html>